{% extends "base.html" %}

{% block title %}AI Documentation - Mindful Horizon{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">AI-Powered Documentation</h1>
        <p class="text-gray-600">Generate clinical notes from session transcripts using AI assistance</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
        <!-- Input Section -->
        <div class="card">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                <i class="fas fa-microphone text-purple-500 mr-2"></i>Session Transcript
            </h3>
            
            <form method="POST">
                <div class="mb-4">
                    <label for="transcript" class="block text-gray-700 font-medium mb-2">
                        Paste or type session transcript below:
                    </label>
                    <textarea id="transcript" name="transcript" rows="12" class="input-field" 
                             placeholder="Patient presented with concerns about anxiety levels increasing over the past week. They mentioned difficulty sleeping and concentrating at work. We discussed coping strategies including deep breathing exercises and progressive muscle relaxation. Patient expressed willingness to try these techniques and agreed to practice daily. Follow-up scheduled for next week to assess progress..."
                             required>{{ request.form.transcript if request.form.transcript }}</textarea>
                </div>
                
                <button type="submit" class="btn-primary w-full">
                    <i class="fas fa-robot mr-2"></i>Generate Clinical Note
                </button>
            </form>
            
            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-800">
                    <i class="fas fa-shield-alt mr-2"></i>
                    All transcripts are processed securely and in compliance with HIPAA regulations.
                </p>
            </div>
        </div>

        <!-- Output Section -->
        <div class="card">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">
                <i class="fas fa-file-medical-alt text-green-500 mr-2"></i>Generated Clinical Note
            </h3>
            
            {% if clinical_note %}
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <pre class="whitespace-pre-wrap text-sm text-gray-800 font-mono">{{ clinical_note }}</pre>
            </div>
            
            <div class="flex space-x-2">
                <button onclick="copyToClipboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                    <i class="fas fa-copy mr-2"></i>Copy Note
                </button>
                <button onclick="downloadNote()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                    <i class="fas fa-download mr-2"></i>Download
                </button>
                <button onclick="editNote()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                    <i class="fas fa-edit mr-2"></i>Edit Note
                </button>
            </div>
            {% else %}
            <div class="bg-gray-100 p-8 rounded-lg text-center">
                <i class="fas fa-file-alt text-gray-400 text-4xl mb-4"></i>
                <p class="text-gray-600">Generated clinical note will appear here after processing the transcript.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- AI Features Information -->
    <div class="card mt-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">
            <i class="fas fa-brain text-blue-500 mr-2"></i>AI Documentation Features
        </h3>
        
        <div class="grid md:grid-cols-3 gap-6">
            <div class="text-center">
                <div class="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-language text-blue-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Natural Language Processing</h4>
                <p class="text-sm text-gray-600">Advanced NLP algorithms extract key clinical information from conversational text.</p>
            </div>
            
            <div class="text-center">
                <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Clinical Accuracy</h4>
                <p class="text-sm text-gray-600">Trained on clinical documentation standards to ensure professional-grade notes.</p>
            </div>
            
            <div class="text-center">
                <div class="bg-purple-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-clock text-purple-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Time Saving</h4>
                <p class="text-sm text-gray-600">Reduce documentation time by up to 70% while maintaining quality and compliance.</p>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const noteText = document.querySelector('pre').textContent;
    navigator.clipboard.writeText(noteText).then(() => {
        alert('Clinical note copied to clipboard!');
    });
}

function downloadNote() {
    const noteText = document.querySelector('pre').textContent;
    const blob = new Blob([noteText], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `clinical_note_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

function editNote() {
    const pre = document.querySelector('pre');
    const currentText = pre.textContent;
    
    // Replace pre with textarea for editing
    const textarea = document.createElement('textarea');
    textarea.value = currentText;
    textarea.className = 'w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-sm';
    
    pre.parentNode.replaceChild(textarea, pre);
    
    // Add save button
    const saveBtn = document.createElement('button');
    saveBtn.textContent = 'Save Changes';
    saveBtn.className = 'bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm mt-2';
    saveBtn.onclick = function() {
        const newPre = document.createElement('pre');
        newPre.className = 'whitespace-pre-wrap text-sm text-gray-800 font-mono';
        newPre.textContent = textarea.value;
        textarea.parentNode.replaceChild(newPre, textarea);
        saveBtn.remove();
    };
    
    textarea.parentNode.insertBefore(saveBtn, textarea.nextSibling);
}
</script>
{% endblock %}
